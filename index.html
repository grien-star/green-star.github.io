<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="color-scheme" content="light" />
  <title>GradeVerify — Automated Grade Verification (Form 137/138)</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,500,650,750&family=Inter:wght@300..900&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg: #fbfaf7;
      --paper: #ffffff;
      --ink: #111116;
      --muted: rgba(17,17,22,.68);
      --soft: rgba(17,17,22,.08);

      --brand: #0f5b4f;
      --brand2:#8a5b13;
      --accent:#b42318;
      --ok:#067647;
      --warn:#b54708;

      --radius-xl: 28px;
      --radius-lg: 18px;

      --shadow: 0 18px 45px rgba(17,17,22,.08);
      --shadow2: 0 10px 25px rgba(17,17,22,.10);

      --grid-gap: clamp(14px, 2.2vw, 22px);
      --max: 1160px;

      --h1: clamp(2.25rem, 4.6vw, 4rem);
      --h2: clamp(1.3rem, 2.2vw, 1.85rem);
      --h3: clamp(1.05rem, 1.6vw, 1.2rem);
      --p: clamp(0.98rem, 1.15vw, 1.05rem);

      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Ubuntu, "Noto Sans";
      color:var(--ink);
      background: var(--bg);
      overflow-x:hidden;
      line-height:1.45;
      letter-spacing: -0.01em;
    }

    .bg{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:-1;
      background:
        radial-gradient(900px 500px at 12% 10%, rgba(15,91,79,.12), transparent 60%),
        radial-gradient(700px 420px at 85% 16%, rgba(138,91,19,.12), transparent 60%),
        radial-gradient(900px 600px at 58% 88%, rgba(17,17,22,.06), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.6), rgba(255,255,255,0));
    }
    .gridlines{
      position:fixed; inset:-2px;
      pointer-events:none;
      z-index:-1;
      opacity:.25;
      background:
        linear-gradient(to right, rgba(17,17,22,.06) 1px, transparent 1px) 0 0 / 54px 54px,
        linear-gradient(to bottom, rgba(17,17,22,.05) 1px, transparent 1px) 0 0 / 54px 54px;
      mask: radial-gradient(65% 55% at 50% 20%, #000 40%, transparent 80%);
    }

    a{ color:inherit; text-decoration:none; }
    .wrap{
      width:min(var(--max), calc(100% - 40px));
      margin-inline:auto;
    }

    header{
      position:sticky; top:0;
      z-index:50;
      backdrop-filter: blur(10px);
      background: color-mix(in srgb, var(--bg) 72%, white 28%);
      border-bottom: 1px solid var(--soft);
    }
    .nav{
      display:flex; align-items:center; justify-content:space-between;
      padding: 14px 0;
      gap:14px;
    }
    .brand{
      display:flex; align-items:center; gap:12px;
      min-width: 220px;
    }
    .mark{
      width:40px; height:40px;
      border-radius: 12px;
      box-shadow: inset 0 0 0 1px rgba(17,17,22,.12), var(--shadow2);
      background:
        radial-gradient(12px 12px at 28% 30%, rgba(255,255,255,.9), transparent 65%),
        conic-gradient(from 210deg, rgba(15,91,79,.95), rgba(138,91,19,.92), rgba(15,91,79,.95));
      position:relative;
      overflow:hidden;
    }
    .mark:after{
      content:"";
      position:absolute; inset:8px;
      border-radius: 10px;
      background: rgba(255,255,255,.75);
      box-shadow: inset 0 0 0 1px rgba(17,17,22,.1);
      mask:
        radial-gradient(10px 10px at 30% 35%, transparent 60%, #000 61%),
        linear-gradient(#000,#000);
      opacity:.8;
    }
    .brand strong{
      font-family: Fraunces, serif;
      font-weight: 750;
      letter-spacing:-0.02em;
      font-size: 1.08rem;
      display:block;
      line-height:1.05;
    }
    .brand span{
      display:block;
      font-size:.82rem;
      color:rgba(17,17,22,.62);
      margin-top:2px;
    }
    nav ul{
      list-style:none; padding:0; margin:0;
      display:flex; align-items:center; gap:18px;
      color: color-mix(in srgb, var(--ink) 74%, transparent);
      font-size:.95rem;
    }
    nav a{
      padding:10px 10px;
      border-radius: 999px;
      transition: background .2s ease, transform .2s ease;
    }
    nav a:hover{ background: rgba(17,17,22,.06); transform: translateY(-1px); }

    .nav-cta{ display:flex; align-items:center; gap:10px; }

    .btn{
      border:0;
      border-radius: 999px;
      padding: 11px 14px;
      font-weight: 650;
      letter-spacing: -0.01em;
      cursor:pointer;
      transition: transform .18s ease, box-shadow .18s ease, background .18s ease, color .18s ease;
      display:inline-flex; align-items:center; gap:10px;
      user-select:none;
      white-space:nowrap;
    }
    .btn:active{ transform: translateY(1px) scale(.99); }
    .btn.primary{
      background: linear-gradient(180deg, color-mix(in srgb, var(--brand) 92%, white 8%), var(--brand));
      color: #fff;
      box-shadow: 0 14px 30px rgba(15,91,79,.18);
    }
    .btn.primary:hover{ transform: translateY(-1px); box-shadow: 0 18px 40px rgba(15,91,79,.22); }
    .btn.ghost{
      background: rgba(255,255,255,.65);
      color: var(--ink);
      box-shadow: inset 0 0 0 1px rgba(17,17,22,.12);
    }
    .btn.ghost:hover{ background: rgba(255,255,255,.9); transform: translateY(-1px); }

    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding: 7px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.7);
      box-shadow: inset 0 0 0 1px rgba(17,17,22,.10);
      font-size:.86rem;
      color: color-mix(in srgb, var(--ink) 78%, transparent);
    }
    .dot{
      width:8px; height:8px; border-radius:999px;
      background: var(--brand);
      box-shadow: 0 0 0 4px rgba(15,91,79,.12);
    }

    .hero{ padding: clamp(28px, 4vw, 52px) 0 22px; }
    .hero-grid{
      display:grid;
      grid-template-columns: 1.25fr .85fr;
      gap: var(--grid-gap);
      align-items: start;
    }
    .hero h1{
      font-family: Fraunces, serif;
      font-size: var(--h1);
      line-height: 1.03;
      margin: 12px 0 14px;
      letter-spacing:-0.03em;
    }
    .hero p{
      font-size: var(--p);
      color: rgba(17,17,22,.68);
      margin: 0 0 18px;
      max-width: 62ch;
    }
    .hero-actions{
      display:flex; flex-wrap:wrap;
      gap: 10px;
      align-items:center;
      margin-top: 14px;
    }

    .spec{ margin-top: 16px; display:flex; flex-wrap:wrap; gap:10px; }
    .spec .pill{ background: color-mix(in srgb, var(--paper) 55%, transparent); backdrop-filter: blur(10px); }
    .spec kbd{
      font-family: var(--mono);
      font-size:.82rem;
      padding: 2px 6px;
      border-radius: 8px;
      background: rgba(17,17,22,.06);
      box-shadow: inset 0 0 0 1px rgba(17,17,22,.08);
    }

    .console{
      border-radius: var(--radius-xl);
      background: linear-gradient(180deg, rgba(255,255,255,.86), rgba(255,255,255,.65));
      box-shadow: var(--shadow);
      border: 1px solid rgba(17,17,22,.10);
      overflow:hidden;
      position:relative;
    }
    .console:before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(500px 220px at 30% 0%, rgba(15,91,79,.13), transparent 60%),
        radial-gradient(520px 260px at 100% 30%, rgba(138,91,19,.12), transparent 55%);
      pointer-events:none;
    }
    .console-top{
      position:relative;
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
      padding: 14px 16px;
      border-bottom: 1px solid rgba(17,17,22,.08);
      background: rgba(255,255,255,.55);
      backdrop-filter: blur(10px);
    }
    .console-title{ display:flex; align-items:center; gap:10px; min-width: 0; }
    .lights{ display:flex; gap:7px; }
    .lights i{
      width:10px; height:10px; border-radius:999px; display:inline-block;
      background: rgba(17,17,22,.18);
      box-shadow: inset 0 0 0 1px rgba(17,17,22,.14);
    }
    .console-title strong{ font-size:.95rem; letter-spacing:-0.01em; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .console-title small{ display:block; color: rgba(17,17,22,.62); font-size:.82rem; margin-top:2px; }

    .console-body{ position:relative; padding: 14px 16px 16px; display:grid; gap: 12px; }

    .field{ display:grid; grid-template-columns: 1fr; gap: 8px; }
    label{
      font-size:.86rem;
      color: color-mix(in srgb, var(--ink) 80%, transparent);
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
    }
    .hint{ font-size:.78rem; color: rgba(17,17,22,.62); display:inline-flex; align-items:center; gap:8px; }
    .hint .badge{
      font-family: var(--mono);
      font-size:.72rem;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(17,17,22,.06);
      box-shadow: inset 0 0 0 1px rgba(17,17,22,.08);
    }

    textarea, input, select{
      width:100%;
      border-radius: 14px;
      border: 1px solid rgba(17,17,22,.14);
      background: rgba(255,255,255,.75);
      padding: 12px 12px;
      font: inherit;
      color: var(--ink);
      outline: none;
      box-shadow: 0 10px 20px rgba(17,17,22,.06);
      transition: border-color .18s ease, box-shadow .18s ease, transform .18s ease, background .18s ease;
    }
    textarea{
      min-height: 110px;
      resize: vertical;
      font-family: var(--mono);
      font-size: .9rem;
      line-height: 1.35;
    }
    input:focus, textarea:focus, select:focus{
      border-color: color-mix(in srgb, var(--brand) 60%, rgba(17,17,22,.14));
      box-shadow: 0 16px 34px rgba(15,91,79,.12);
      background: rgba(255,255,255,.9);
      transform: translateY(-1px);
    }

    .fileRow{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      align-items:end;
    }
    .fileBox{
      border-radius: 16px;
      background: rgba(255,255,255,.6);
      box-shadow: inset 0 0 0 1px rgba(17,17,22,.10);
      padding: 10px 12px;
      display:grid;
      gap: 8px;
    }
    .fileBox strong{ font-size:.9rem; letter-spacing:-0.01em; }
    .fileBox small{ color: rgba(17,17,22,.62); }
    .fileBox input[type="file"]{
      padding: 10px 10px;
      border-radius: 12px;
      background: rgba(255,255,255,.7);
      box-shadow: inset 0 0 0 1px rgba(17,17,22,.12);
      border: 0;
    }
    .fileBox input[type="file"]:focus{
      outline: 2px solid color-mix(in srgb, var(--brand) 40%, transparent);
      outline-offset: 2px;
    }

    .console-actions{
      display:flex; flex-wrap:wrap; gap:10px;
      align-items:center; justify-content:space-between;
      padding-top: 2px;
    }
    .toggle{
      display:flex; align-items:center; gap:10px;
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.65);
      box-shadow: inset 0 0 0 1px rgba(17,17,22,.12);
      font-size:.9rem;
      color: color-mix(in srgb, var(--ink) 78%, transparent);
      user-select:none;
      cursor:pointer;
    }
    .switch{
      width:42px; height:24px;
      border-radius: 999px;
      background: rgba(17,17,22,.18);
      position:relative;
      box-shadow: inset 0 0 0 1px rgba(17,17,22,.12);
      transition: background .18s ease;
    }
    .switch:after{
      content:"";
      width:18px; height:18px;
      border-radius: 999px;
      background: #fff;
      position:absolute; top:3px; left:3px;
      box-shadow: 0 6px 14px rgba(17,17,22,.18);
      transition: transform .18s ease;
    }
    .toggle[data-on="true"] .switch{ background: rgba(15,91,79,.55); }
    .toggle[data-on="true"] .switch:after{ transform: translateX(18px); }

    .results{
      margin-top: 10px;
      border-radius: var(--radius-lg);
      border: 1px solid rgba(17,17,22,.10);
      background: rgba(255,255,255,.72);
      overflow:hidden;
    }
    .results-head{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
      padding: 12px 12px;
      border-bottom: 1px solid rgba(17,17,22,.08);
      background: rgba(255,255,255,.55);
    }
    .results-head strong{ font-size:.95rem; letter-spacing:-0.01em; }
    .score{
      display:flex; gap:8px; align-items:center; flex-wrap:wrap;
      justify-content:flex-end;
      color: rgba(17,17,22,.62);
      font-size:.88rem;
    }
    .meter{
      height: 10px; width: 140px;
      border-radius: 999px;
      background: rgba(17,17,22,.08);
      overflow:hidden;
      box-shadow: inset 0 0 0 1px rgba(17,17,22,.06);
    }
    .meter > i{
      display:block; height:100%;
      width: 0%;
      background: linear-gradient(90deg, var(--ok), color-mix(in srgb, var(--ok) 55%, var(--brand2)));
      border-radius: 999px;
      transition: width .45s ease;
    }
    .log{ padding: 10px 12px 12px; display:grid; gap: 10px; }
    .item{
      display:grid;
      grid-template-columns: auto 1fr;
      gap: 10px;
      align-items:flex-start;
      padding: 10px 10px;
      border-radius: 14px;
      background: rgba(255,255,255,.72);
      box-shadow: inset 0 0 0 1px rgba(17,17,22,.08);
    }
    .sev{
      width:34px; height:34px;
      border-radius: 12px;
      display:grid; place-items:center;
      font-family: var(--mono);
      font-weight: 800;
      font-size:.82rem;
      box-shadow: 0 10px 20px rgba(17,17,22,.08);
    }
    .sev.ok{ background: rgba(6,118,71,.12); color: var(--ok); }
    .sev.warn{ background: rgba(181,71,8,.14); color: var(--warn); }
    .sev.bad{ background: rgba(180,35,24,.14); color: var(--accent); }
    .item h4{ margin: 0; font-size: .95rem; letter-spacing:-0.01em; font-weight: 700; }
    .item p{ margin: 4px 0 0; color: rgba(17,17,22,.68); font-size: .9rem; }
    .meta{ margin-top: 8px; display:flex; flex-wrap:wrap; gap:8px; color: rgba(17,17,22,.62); font-size: .82rem; }
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(17,17,22,.06);
      box-shadow: inset 0 0 0 1px rgba(17,17,22,.06);
      font-family: var(--mono);
      font-size:.78rem;
    }

    section{ padding: 34px 0; }
    .section-head{
      display:flex; align-items:flex-end; justify-content:space-between;
      gap:18px;
      margin-bottom: 18px;
    }
    .section-head h2{
      font-family: Fraunces, serif;
      font-size: var(--h2);
      margin:0;
      letter-spacing:-0.02em;
      line-height:1.12;
    }
    .section-head p{
      margin:0;
      color: rgba(17,17,22,.68);
      max-width: 62ch;
      font-size: var(--p);
    }

    .bento{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap: var(--grid-gap);
      align-items:stretch;
    }
    .panel{
      border-radius: var(--radius-xl);
      background: rgba(255,255,255,.72);
      border: 1px solid rgba(17,17,22,.10);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .panel .inner{ padding: 18px 18px; display:grid; gap: 12px; }
    .panel h3{ margin:0; font-size: var(--h3); letter-spacing:-0.01em; }
    .panel p{ margin:0; color: rgba(17,17,22,.68); font-size: 0.98rem; max-width: 68ch; }
    .panel .rule{ height:1px; background: rgba(17,17,22,.10); margin: 2px 0; }

    footer{
      padding: 30px 0 40px;
      border-top: 1px solid rgba(17,17,22,.08);
      color: color-mix(in srgb, var(--ink) 78%, transparent);
    }
    .foot{ display:flex; flex-wrap:wrap; align-items:flex-start; justify-content:space-between; gap: 18px; }
    .foot small{ color: rgba(17,17,22,.68); display:block; margin-top:8px; max-width: 70ch; }

    .reveal{
      opacity:0;
      transform: translateY(12px);
      animation: rise .7s cubic-bezier(.2,.85,.2,1) forwards;
    }
    .d1{ animation-delay:.06s; }
    .d2{ animation-delay:.14s; }
    .d3{ animation-delay:.22s; }
    .d4{ animation-delay:.30s; }
    @keyframes rise{ to{ opacity:1; transform: translateY(0); } }

    .sr{
      opacity:0;
      transform: translateY(14px);
      transition: opacity .65s cubic-bezier(.2,.85,.2,1), transform .65s cubic-bezier(.2,.85,.2,1);
    }
    .sr.on{ opacity:1; transform: translateY(0); }

    @media (max-width: 980px){
      .hero-grid{ grid-template-columns: 1fr; }
      nav ul{ display:none; }
      .bento{ grid-template-columns: 1fr; }
      .meter{ width: 120px; }
      .fileRow{ grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <div class="bg" aria-hidden="true"></div>
  <div class="gridlines" aria-hidden="true"></div>

  <header>
    <div class="wrap nav">
      <a class="brand" href="#top" aria-label="GradeVerify home">
        <div class="mark" aria-hidden="true"></div>
        <div>
          <strong>GradeVerify</strong>
          <span>Automated verification for Form 137/138</span>
        </div>
      </a>

      <nav aria-label="Primary">
        <ul>
          <li><a href="#how">How it works</a></li>
          <li><a href="#demo">Live demo</a></li>
          <li><a href="#notes">Notes</a></li>
        </ul>
      </nav>

      <div class="nav-cta">
        <span class="pill" title="Runs locally in your browser demo">
          <span class="dot" aria-hidden="true"></span>
          Offline-ready demo
        </span>
        <button class="btn ghost" type="button" id="btnFill">Load sample</button>
        <button class="btn primary" type="button" id="btnRunTop">
          Run verification
          <span aria-hidden="true" style="font-family:var(--mono); font-weight:800; opacity:.9;">↵</span>
        </button>
      </div>
    </div>
  </header>

  <main id="top">
    <section class="hero">
      <div class="wrap hero-grid">
        <div>
          <div class="reveal d1">
            <span class="pill">
              <span class="dot" aria-hidden="true"></span>
              Paste or import (.xlsx) • verify • audit
            </span>
          </div>

          <h1 class="reveal d2">
            Automated grade verification for <em style="font-style:normal; color:var(--brand);">Form 137</em>,
            <em style="font-style:normal; color:var(--brand2);">Form 138</em>, and final grade summaries.
          </h1>

          <p class="reveal d3">
            Now with optional Excel import: upload an <strong>.xlsx</strong> file, map the sheet/columns, and auto-fill the forms for verification.
            Your data stays in the browser in this prototype.
          </p>

          <div class="hero-actions reveal d4">
            <button class="btn primary" type="button" id="btnJumpDemo">Open verification console</button>
            <a class="btn ghost" href="#how">See workflow</a>

            <div class="spec" aria-label="Keyboard tips">
              <span class="pill"><kbd>Enter</kbd> run</span>
              <span class="pill"><kbd>Ctrl</kbd> + <kbd>L</kbd> load sample</span>
              <span class="pill"><kbd>Esc</kbd> clear</span>
            </div>
          </div>
        </div>

        <aside class="console reveal d2" id="demo" aria-label="Verification console">
          <div class="console-top">
            <div class="console-title">
              <div class="lights" aria-hidden="true"><i></i><i></i><i></i></div>
              <div style="min-width:0">
                <strong>Verification Console</strong>
                <small>Paste data or import Excel (.xlsx) • run checks</small>
              </div>
            </div>
            <span class="pill" title="This is a UI demo. Connect to OCR/DB later.">
              <span class="dot" aria-hidden="true" style="background:color-mix(in srgb, var(--brand2) 85%, white 15%); box-shadow:0 0 0 4px rgba(138,91,19,.12)"></span>
              Demo mode
            </span>
          </div>

          <div class="console-body">
            <div class="fileRow" aria-label="Excel import">
              <div class="fileBox">
                <strong>Import from Excel (.xlsx)</strong>
                <small>Uploads are processed locally in your browser.</small>
                <input id="xlsxFile" type="file" accept=".xlsx" aria-label="Upload an XLSX file" />
              </div>

              <div class="fileBox">
                <strong>Sheet & column mapping</strong>
                <small>Select a sheet, then map columns for Subject / Q1..Q4 / Final.</small>
                <div style="display:grid; gap:10px;">
                  <select id="sheetSelect" aria-label="Select sheet" disabled>
                    <option value="">No file loaded</option>
                  </select>

                  <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                    <select id="mapTarget" aria-label="Choose which textbox to fill" disabled>
                      <option value="form137">Fill: Form 137</option>
                      <option value="form138">Fill: Form 138</option>
                      <option value="summary">Fill: Summary</option>
                    </select>

                    <select id="headerRowMode" aria-label="Header mode" disabled>
                      <option value="hasHeader" selected>First row is header</option>
                      <option value="noHeader">No header (use A,B,C...)</option>
                    </select>
                  </div>

                  <button class="btn ghost" type="button" id="btnAutoMap" disabled>Auto-detect columns</button>
                </div>
              </div>
            </div>

            <div class="field">
              <label for="ruleSet">
                Ruleset
                <span class="hint"><span class="badge">policy</span> rounding + range</span>
              </label>
              <select id="ruleSet" aria-label="Select verification ruleset">
                <option value="ph-basic" selected>PH Basic (0–100, integer, average = rounded)</option>
                <option value="ph-decimal">PH Decimal (0–100, allow .25/.5/.75)</option>
                <option value="strict">Strict (0–100, integer, no rounding tolerance)</option>
              </select>
            </div>

            <div class="field">
              <label for="form137">
                Form 137 (Permanent Record)
                <span class="hint"><span class="badge">csv</span> subject,q1,q2,q3,q4,final</span>
              </label>
              <textarea id="form137" spellcheck="false" placeholder="Paste here or import .xlsx"></textarea>
            </div>

            <div class="field">
              <label for="form138">
                Form 138 (Report Card)
                <span class="hint"><span class="badge">csv</span> subject,q1,q2,q3,q4,final</span>
              </label>
              <textarea id="form138" spellcheck="false" placeholder="Paste here or import .xlsx"></textarea>
            </div>

            <div class="field">
              <label for="summary">
                Summary of Final Grades
                <span class="hint"><span class="badge">csv</span> subject,final</span>
              </label>
              <textarea id="summary" spellcheck="false" placeholder="Paste here or import .xlsx"></textarea>
            </div>

            <div class="console-actions" aria-label="Console actions">
              <div style="display:flex; flex-wrap:wrap; gap:10px; align-items:center;">
                <div class="toggle" id="toggleNormalize" role="switch" aria-checked="true" tabindex="0" data-on="true">
                  <div class="switch" aria-hidden="true"></div>
                  Normalize subject names
                </div>

                <div class="toggle" id="toggleTolerance" role="switch" aria-checked="true" tabindex="0" data-on="true">
                  <div class="switch" aria-hidden="true"></div>
                  Allow ±1 tolerance
                </div>
              </div>

              <div style="display:flex; gap:10px; align-items:center;">
                <button class="btn ghost" type="button" id="btnClear">Clear</button>
                <button class="btn primary" type="button" id="btnRun">Run verification</button>
              </div>
            </div>

            <div class="results" aria-live="polite">
              <div class="results-head">
                <strong>Audit results</strong>
                <div class="score">
                  <span id="scoreText">Waiting for input</span>
                  <span class="meter" aria-hidden="true"><i id="meterBar"></i></span>
                </div>
              </div>
              <div class="log" id="log">
                <div class="item">
                  <div class="sev warn">i</div>
                  <div>
                    <h4>Tip: Excel import requires a parsing library.</h4>
                    <p>
                      This single-file prototype does not include external libraries. To enable real <code>.xlsx</code> parsing,
                      integrate a bundled XLSX parser (e.g., SheetJS) into this file during your build step.
                      Below, the UI and hooks are ready; you’ll see guidance if you try to import.
                    </p>
                    <div class="meta">
                      <span class="chip">Why: XLSX is a zipped binary format</span>
                      <span class="chip">Solution: bundle an XLSX parser</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </aside>
      </div>
    </section>

    <section id="how" class="sr">
      <div class="wrap">
        <div class="section-head">
          <div>
            <h2>How it works</h2>
            <p>
              Paste CSV-like rows or import from Excel. The verifier recalculates finals and checks consistency across Form 137, Form 138, and the Summary.
            </p>
          </div>
        </div>

        <div class="bento">
          <article class="panel">
            <div class="inner">
              <h3>Excel import flow (when enabled)</h3>
              <p>
                Upload an .xlsx, pick a sheet, auto-detect columns, then it converts rows into the same CSV format used by the verifier.
              </p>
              <div class="rule"></div>
              <p style="font-family:var(--mono); font-size:.9rem; color:rgba(17,17,22,.72); margin:0;">
                subject,q1,q2,q3,q4,final<br/>
                English,88,90,89,91,90
              </p>
            </div>
          </article>

          <article class="panel" id="notes">
            <div class="inner">
              <h3>Important note</h3>
              <p>
                Because you requested a single-file site and external URLs are disallowed, a real XLSX parser cannot be loaded from a CDN here.
                In production, you would bundle an XLSX parser (like SheetJS) into your app build and it will work seamlessly.
              </p>
              <div class="rule"></div>
              <p style="margin:0; color:rgba(17,17,22,.68); font-size:.95rem;">
                If you want, I can provide a version that includes the parser as an embedded minified script (large file), or provide a build-ready setup (Vite/Webpack) that bundles it.
              </p>
            </div>
          </article>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="wrap foot">
      <div>
        <strong style="font-family:Fraunces, serif; letter-spacing:-0.02em;">GradeVerify</strong>
        <small>
          Front-end prototype for automated grade verification. For real .xlsx import, bundle an XLSX parser during build.
        </small>
      </div>
    </div>
  </footer>

  <script>
    const $ = (sel, root=document) => root.querySelector(sel);

    const els = {
      ruleSet: $("#ruleSet"),
      form137: $("#form137"),
      form138: $("#form138"),
      summary: $("#summary"),
      log: $("#log"),
      scoreText: $("#scoreText"),
      meterBar: $("#meterBar"),
      toggleNormalize: $("#toggleNormalize"),
      toggleTolerance: $("#toggleTolerance"),
      btnRun: $("#btnRun"),
      btnRunTop: $("#btnRunTop"),
      btnFill: $("#btnFill"),
      btnClear: $("#btnClear"),
      btnJumpDemo: $("#btnJumpDemo"),
      xlsxFile: $("#xlsxFile"),
      sheetSelect: $("#sheetSelect"),
      mapTarget: $("#mapTarget"),
      headerRowMode: $("#headerRowMode"),
      btnAutoMap: $("#btnAutoMap")
    };

    const sample = {
      form137:
`English, 88, 90, 89, 91, 90
Mathematics, 84, 86, 85, 87, 86
Science, 89, 88, 90, 90, 89
Araling Panlipunan, 92, 91, 92, 93, 92
MAPEH, 90, 90, 89, 90, 90
EPP/TLE, 85, 85, 86, 86, 86`,
      form138:
`English, 88, 90, 89, 91, 90
Math, 84, 86, 85, 87, 85
Science, 89, 88, 90, 90, 89
Araling Panlipunan, 92, 91, 92, 93, 92
MAPEH, 90, 90, 89, 90, 90
EPP / TLE, 85, 85, 86, 86, 86`,
      summary:
`English, 90
Math, 86
Science, 89
Araling Panlipunan, 92
MAPEH, 90
EPP/TLE, 86`
    };

    function setToggle(el, on){
      el.dataset.on = on ? "true" : "false";
      el.setAttribute("aria-checked", on ? "true" : "false");
    }
    function toggleToggle(el){ setToggle(el, el.dataset.on !== "true"); }
    function isOn(el){ return el.dataset.on === "true"; }

    function normSubject(s){
      return s.toLowerCase().trim()
        .replace(/\s+/g, " ")
        .replace(/[.,]/g, "")
        .replace(/\s*\/\s*/g, "/")
        .replace(/&/g, "and");
    }
    function subjectAliasKey(s){
      const t = normSubject(s);
      const map = new Map([
        ["math", "mathematics"],
        ["mathematics", "mathematics"],
        ["epp/tle", "epp/tle"],
        ["epp / tle", "epp/tle"],
        ["epp tle", "epp/tle"],
        ["mapeh", "mapeh"],
        ["araling panlipunan", "araling panlipunan"],
        ["ap", "araling panlipunan"],
        ["english", "english"],
        ["science", "science"]
      ]);
      return map.get(t) ?? t;
    }

    function parseCSVLike(text, expectedColsMin){
      const rows = text.split(/\r?\n/).map(r => r.trim()).filter(Boolean);
      const parsed = [];
      const errors = [];
      rows.forEach((row, idx) => {
        const parts = row.split(",").map(p => p.trim());
        if(parts.length < expectedColsMin){
          errors.push({
            type: "format", sev: "warn",
            title: "Row has too few columns",
            msg: `Line ${idx+1}: expected at least ${expectedColsMin} columns but got ${parts.length}.`,
            meta: [`line:${idx+1}`]
          });
          return;
        }
        parsed.push({ line: idx+1, parts });
      });
      return { parsed, errors };
    }

    function toNum(x){
      const v = Number(String(x).replace(/[^\d.-]/g,""));
      return Number.isFinite(v) ? v : NaN;
    }

    function roundingPolicy(ruleSet){
      if(ruleSet === "ph-decimal"){
        return { allowDecimals: true, roundFinal: (x)=> Math.round(x*4)/4, name: "PH Decimal" };
      }
      if(ruleSet === "strict"){
        return { allowDecimals: false, roundFinal: (x)=> x, name: "Strict" };
      }
      return { allowDecimals: false, roundFinal: (x)=> Math.round(x), name: "PH Basic" };
    }

    function gradeValid(n, allowDecimals){
      if(!Number.isFinite(n)) return false;
      if(n < 0 || n > 100) return false;
      if(!allowDecimals && !Number.isInteger(n)) return false;
      if(allowDecimals){
        const frac = Math.round((n - Math.floor(n))*100)/100;
        const ok = [0, .25, .5, .75].some(v => Math.abs(frac - v) < 1e-9);
        return ok || Number.isInteger(n);
      }
      return true;
    }

    function computeFinal(qs, policy){
      const avg = (qs.reduce((a,b)=>a+b,0))/qs.length;
      return policy.roundFinal(avg);
    }

    function buildMapFromForm(text, normalize, policy){
      const { parsed, errors } = parseCSVLike(text, 6);
      const map = new Map();
      const issues = [...errors];

      parsed.forEach(({line, parts})=>{
        const subjectRaw = parts[0];
        const key = normalize ? subjectAliasKey(subjectRaw) : subjectRaw.trim();

        const q = [parts[1],parts[2],parts[3],parts[4]].map(toNum);
        const final = toNum(parts[5]);

        if(q.some(v => !Number.isFinite(v))){
          issues.push({ type:"missing", sev:"warn", title:"Missing/non-numeric quarter grade",
            msg:`${subjectRaw}: one or more quarters could not be read as a number.`,
            meta:[`line:${line}`]});
        }

        q.forEach((v,i)=>{
          if(Number.isFinite(v) && !gradeValid(v, policy.allowDecimals)){
            issues.push({ type:"range", sev:"bad", title:"Quarter grade out of policy",
              msg:`${subjectRaw}: Q${i+1} = ${v} is not valid for ruleset.`,
              meta:[`line:${line}`, `q${i+1}:${v}`]});
          }
        });

        if(Number.isFinite(final) && !gradeValid(final, policy.allowDecimals)){
          issues.push({ type:"range", sev:"bad", title:"Final grade out of policy",
            msg:`${subjectRaw}: Final = ${final} is not valid for ruleset.`,
            meta:[`line:${line}`, `final:${final}`]});
        }

        let computed = NaN;
        if(q.every(Number.isFinite)) computed = computeFinal(q, policy);

        map.set(key, { subjectRaw, key, line, q, final, computed });
      });

      return { map, issues };
    }

    function buildMapFromSummary(text, normalize, policy){
      const { parsed, errors } = parseCSVLike(text, 2);
      const map = new Map();
      const issues = [...errors];

      parsed.forEach(({line, parts})=>{
        const subjectRaw = parts[0];
        const key = normalize ? subjectAliasKey(subjectRaw) : subjectRaw.trim();
        const final = toNum(parts[1]);

        if(!Number.isFinite(final)){
          issues.push({ type:"missing", sev:"warn", title:"Missing/non-numeric summary final",
            msg:`${subjectRaw}: summary final could not be read as a number.`,
            meta:[`line:${line}`]});
        } else if(!gradeValid(final, policy.allowDecimals)){
          issues.push({ type:"range", sev:"bad", title:"Summary final out of policy",
            msg:`${subjectRaw}: Summary final = ${final} is not valid for ruleset.`,
            meta:[`line:${line}`, `final:${final}`]});
        }

        map.set(key, { subjectRaw, key, line, final });
      });

      return { map, issues };
    }

    function withinTolerance(a,b,tol){
      if(!Number.isFinite(a) || !Number.isFinite(b)) return false;
      return Math.abs(a-b) <= tol;
    }

    function renderLog(items, score){
      els.log.innerHTML = "";
      const frag = document.createDocumentFragment();

      items.forEach((it, idx)=>{
        const row = document.createElement("div");
        row.className = "item";
        row.style.animation = "rise .65s cubic-bezier(.2,.85,.2,1) forwards";
        row.style.opacity = "0";
        row.style.transform = "translateY(10px)";
        row.style.animationDelay = (idx * 0.05) + "s";

        const sev = document.createElement("div");
        sev.className = "sev " + (it.sev || "warn");
        sev.textContent = (it.sev === "bad") ? "!" : (it.sev === "ok") ? "✓" : "•";

        const body = document.createElement("div");
        const h = document.createElement("h4");
        h.textContent = it.title || "Result";
        const p = document.createElement("p");
        p.textContent = it.msg || "";

        body.appendChild(h);
        body.appendChild(p);

        if(it.meta && it.meta.length){
          const meta = document.createElement("div");
          meta.className = "meta";
          it.meta.slice(0,5).forEach(m=>{
            const chip = document.createElement("span");
            chip.className = "chip";
            chip.textContent = m;
            meta.appendChild(chip);
          });
          body.appendChild(meta);
        }

        row.appendChild(sev);
        row.appendChild(body);
        frag.appendChild(row);
      });

      els.log.appendChild(frag);

      if(score === 0 && items.length && (items[0].title || "").includes("No input")){
        els.scoreText.textContent = "Waiting for input";
        els.meterBar.style.width = "0%";
        return;
      }
      els.scoreText.textContent = `Verification score: ${score}%`;
      els.meterBar.style.width = `${score}%`;
    }

    function verify(){
      const policy = roundingPolicy(els.ruleSet.value);
      const normalize = isOn(els.toggleNormalize);
      const tolOn = isOn(els.toggleTolerance);
      const tol = tolOn ? 1 : 0;

      const text137 = els.form137.value.trim();
      const text138 = els.form138.value.trim();
      const textSum = els.summary.value.trim();

      const items = [];

      if(!text137 && !text138 && !textSum){
        renderLog([{
          sev:"warn",
          title:"No input provided",
          msg:"Paste your Form 137, Form 138, and Summary data (or load the sample) to run verification.",
          meta:[`ruleset:${policy.name}`, `normalize:${normalize}`, `tolerance:±${tol}`]
        }], 0);
        return;
      }

      const a = buildMapFromForm(text137, normalize, policy);
      const b = buildMapFromForm(text138, normalize, policy);
      const s = buildMapFromSummary(textSum, normalize, policy);

      items.push(...a.issues, ...b.issues, ...s.issues);

      function checkComputed(formName, entry){
        if(entry.q.every(Number.isFinite) && Number.isFinite(entry.final)){
          const ok = withinTolerance(entry.final, entry.computed, tol);
          if(!ok){
            items.push({
              sev: tolOn ? "warn" : "bad",
              title: `Final grade mismatch (${formName})`,
              msg: `${entry.subjectRaw}: stated final ${entry.final} ≠ computed ${entry.computed} from Q1–Q4 under "${policy.name}".`,
              meta:[`form:${formName}`, `line:${entry.line}`, `tol:±${tol}`]
            });
          }
        }
      }
      a.map.forEach(v=> checkComputed("Form 137", v));
      b.map.forEach(v=> checkComputed("Form 138", v));

      const keys = new Set([...a.map.keys(), ...b.map.keys(), ...s.map.keys()]);
      keys.forEach((k)=>{
        const e137 = a.map.get(k);
        const e138 = b.map.get(k);
        const esum = s.map.get(k);

        if(e137 && !e138){
          items.push({ sev:"warn", title:"Subject missing in Form 138",
            msg:`${e137.subjectRaw}: found in Form 137 but not in Form 138.`,
            meta:[`subjectKey:${k}`]});
        }
        if(e138 && !e137){
          items.push({ sev:"warn", title:"Subject missing in Form 137",
            msg:`${e138.subjectRaw}: found in Form 138 but not in Form 137.`,
            meta:[`subjectKey:${k}`]});
        }
        if((e137 || e138) && !esum){
          const name = e137?.subjectRaw ?? e138?.subjectRaw ?? k;
          items.push({ sev:"warn", title:"Subject missing in Summary",
            msg:`${name}: present in forms but not listed in the Summary of Final Grades.`,
            meta:[`subjectKey:${k}`]});
        }

        const f137 = e137?.final;
        const f138 = e138?.final;
        const fsum = esum?.final;

        const pairs = [
          ["Form 137", f137, "Form 138", f138, e137?.subjectRaw ?? e138?.subjectRaw ?? k],
          ["Form 137", f137, "Summary", fsum, e137?.subjectRaw ?? esum?.subjectRaw ?? k],
          ["Form 138", f138, "Summary", fsum, e138?.subjectRaw ?? esum?.subjectRaw ?? k]
        ];

        pairs.forEach(([n1,v1,n2,v2,label])=>{
          if(Number.isFinite(v1) && Number.isFinite(v2)){
            const ok = withinTolerance(v1, v2, tol);
            if(!ok){
              items.push({ sev:"bad", title:"Cross-form mismatch",
                msg:`${label}: ${n1} final ${v1} ≠ ${n2} final ${v2}.`,
                meta:[`subjectKey:${k}`, `tol:±${tol}`]});
            }
          }
        });
      });

      if(items.length === 0){
        items.push({
          sev:"ok",
          title:"No issues detected",
          msg:`All checks passed under "${policy.name}" with normalization ${normalize ? "ON" : "OFF"} and tolerance ±${tol}.`,
          meta:[`forms:137/138/summary`]
        });
      } else {
        const counts = items.reduce((acc,it)=>{ acc[it.sev]=(acc[it.sev]||0)+1; return acc; }, {});
        items.unshift({
          sev: (counts.bad ? "bad" : counts.warn ? "warn" : "ok"),
          title:"Verification completed",
          msg:`Found ${items.length} item(s): ${counts.bad||0} critical, ${counts.warn||0} warning, ${counts.ok||0} ok.`,
          meta:[`ruleset:${roundingPolicy(els.ruleSet.value).name}`, `normalize:${normalize}`, `tolerance:±${tol}`]
        });
      }

      const bad = items.filter(i=>i.sev==="bad").length;
      const warn = items.filter(i=>i.sev==="warn").length;
      const total = Math.max(1, items.length - 1);
      const penalty = Math.min(1, (bad*1 + warn*0.45) / Math.max(1,total));
      const score = Math.round((1-penalty)*100);

      renderLog(items, score);
    }

    function loadSample(){
      els.form137.value = sample.form137;
      els.form138.value = sample.form138;
      els.summary.value = sample.summary;
      setToggle(els.toggleNormalize, true);
      setToggle(els.toggleTolerance, true);
      verify();
      $("#demo").scrollIntoView({behavior:"smooth", block:"start"});
    }

    function clearAll(){
      els.form137.value = "";
      els.form138.value = "";
      els.summary.value = "";
      renderLog([{
        sev:"warn",
        title:"Cleared",
        msg:"Inputs were cleared. Paste new rows, load the sample, or import from Excel once XLSX parsing is bundled.",
        meta:[`tip: Ctrl+L to load sample`]
      }], 0);
      els.form137.focus();
    }

    // XLSX Import Hooks (UI-ready; parser must be bundled for real XLSX support)
    let workbookCache = null;

    function xlsxAvailable(){
      // If you bundle SheetJS, it typically exposes window.XLSX
      return typeof window.XLSX !== "undefined";
    }

    function showXlsxNeeded(){
      renderLog([{
        sev:"warn",
        title:"XLSX parser not included",
        msg:"To import .xlsx files in-browser, bundle an XLSX parser (e.g., SheetJS). This prototype forbids external URLs, so the parser is not loaded from a CDN.",
        meta:[
          "expected: window.XLSX",
          "option A: bundle via Vite/Webpack",
          "option B: embed minified parser (large)"
        ]
      }], 0);
    }

    async function handleXlsxFile(file){
      if(!file) return;
      if(!xlsxAvailable()){
        showXlsxNeeded();
        return;
      }

      const buf = await file.arrayBuffer();
      const wb = window.XLSX.read(buf, { type: "array" });
      workbookCache = wb;

      // Populate sheet dropdown
      els.sheetSelect.disabled = false;
      els.mapTarget.disabled = false;
      els.headerRowMode.disabled = false;
      els.btnAutoMap.disabled = false;

      els.sheetSelect.innerHTML = "";
      wb.SheetNames.forEach((name, i)=>{
        const opt = document.createElement("option");
        opt.value = name;
        opt.textContent = `${i+1}. ${name}`;
        els.sheetSelect.appendChild(opt);
      });

      renderLog([{
        sev:"ok",
        title:"Excel loaded",
        msg:`Loaded ${file.name}. Select a sheet, then auto-detect columns to fill a form textbox.`,
        meta:[`sheets:${wb.SheetNames.length}`, `file:${file.name}`]
      }], 0);
    }

    function autoDetectAndFill(){
      if(!workbookCache) return;
      const sheetName = els.sheetSelect.value;
      const ws = workbookCache.Sheets[sheetName];
      if(!ws) return;

      const headerMode = els.headerRowMode.value; // hasHeader | noHeader
      const target = els.mapTarget.value; // form137 | form138 | summary

      // Convert sheet to rows
      // If "hasHeader", the first row becomes keys; else we use A,B,C...
      const json = window.XLSX.utils.sheet_to_json(ws, {
        header: headerMode === "hasHeader" ? 1 : "A",
        raw: true,
        defval: ""
      });

      if(!json || json.length === 0){
        renderLog([{ sev:"warn", title:"Empty sheet", msg:"The selected sheet has no readable rows.", meta:[`sheet:${sheetName}`] }], 0);
        return;
      }

      let rows = json;

      // If hasHeader and using header:1, json[0] is header row array
      let headers = null;
      if(headerMode === "hasHeader"){
        headers = rows[0].map(h => String(h || "").trim());
        rows = rows.slice(1);
      } else {
        // with header:"A", objects; normalize to array by taking values in A..Z order
        // We'll create a header list from first object keys.
        const first = json[0];
        headers = Object.keys(first);
        rows = json.map(obj => headers.map(k => obj[k]));
      }

      // Heuristic: detect columns by header names or by value types
      const lowerHeaders = headers.map(h => String(h).toLowerCase());

      const findCol = (cands) => {
        for(const cand of cands){
          const idx = lowerHeaders.findIndex(h => h === cand || h.includes(cand));
          if(idx !== -1) return idx;
        }
        return -1;
      };

      let cSubject = findCol(["subject","learning area","learningarea","course","name"]);
      let cQ1 = findCol(["q1","1st","first","quarter 1","quarter1","first quarter"]);
      let cQ2 = findCol(["q2","2nd","second","quarter 2","quarter2","second quarter"]);
      let cQ3 = findCol(["q3","3rd","third","quarter 3","quarter3","third quarter"]);
      let cQ4 = findCol(["q4","4th","fourth","quarter 4","quarter4","fourth quarter"]);
      let cFinal = findCol(["final","final grade","finalgrade","average","avg"]);

      // If headers are not informative, fallback by scanning first rows:
      const guessNumericCols = () => {
        const colCount = headers.length;
        const score = new Array(colCount).fill(0);
        const sampleCount = Math.min(20, rows.length);

        for(let r=0;r<sampleCount;r++){
          const row = rows[r] || [];
          for(let c=0;c<colCount;c++){
            const v = row[c];
            const n = Number(String(v).replace(/[^\d.-]/g,""));
            if(Number.isFinite(n)) score[c] += 1;
          }
        }
        return score.map((s, idx)=>({idx, s})).sort((a,b)=>b.s-a.s);
      };

      if(cSubject === -1){
        // subject likely the most text-like column: lowest numeric-ness among non-empty
        const numeric = guessNumericCols();
        // pick the least numeric column among the first few
        const colCount = headers.length;
        const numScore = new Array(colCount).fill(0);
        numeric.forEach(x => numScore[x.idx]=x.s);
        let best = 0, bestScore = Infinity;
        for(let c=0;c<colCount;c++){
          const nonEmpty = rows.slice(0,10).some(r => String((r||[])[c] ?? "").trim() !== "");
          if(!nonEmpty) continue;
          if(numScore[c] < bestScore){
            bestScore = numScore[c];
            best = c;
          }
        }
        cSubject = best;
      }

      // For grade columns: pick top numeric columns (excluding subject col)
      const numericCols = guessNumericCols().filter(x => x.idx !== cSubject);
      const top = numericCols.slice(0, 6).map(x=>x.idx);

      // If any quarter/final missing, assign in order from top numeric cols
      const fillIfMissing = (current, fallbackIndex) => current !== -1 ? current : (top[fallbackIndex] ?? -1);
      cQ1 = fillIfMissing(cQ1, 0);
      cQ2 = fillIfMissing(cQ2, 1);
      cQ3 = fillIfMissing(cQ3, 2);
      cQ4 = fillIfMissing(cQ4, 3);
      cFinal = fillIfMissing(cFinal, 4);

      // Build CSV text
      const lines = [];
      const maxRows = 2500; // guard
      for(let i=0;i<Math.min(rows.length, maxRows);i++){
        const row = rows[i] || [];
        const subj = String(row[cSubject] ?? "").trim();
        if(!subj) continue;

        if(target === "summary"){
          const final = row[cFinal];
          lines.push(`${subj}, ${final}`);
        } else {
          const q1 = row[cQ1], q2=row[cQ2], q3=row[cQ3], q4=row[cQ4], fin=row[cFinal];
          lines.push(`${subj}, ${q1}, ${q2}, ${q3}, ${q4}, ${fin}`);
        }
      }

      const out = lines.join("\n");
      if(target === "form137") els.form137.value = out;
      if(target === "form138") els.form138.value = out;
      if(target === "summary") els.summary.value = out;

      renderLog([{
        sev:"ok",
        title:"Imported to text area",
        msg:`Filled ${target} from "${sheetName}" using auto-detected columns. Review the text, then run verification.`,
        meta:[
          `sheet:${sheetName}`,
          `rows:${lines.length}`,
          `target:${target}`
        ]
      }], 0);
    }

    // Events
    els.btnRun.addEventListener("click", verify);
    els.btnRunTop.addEventListener("click", ()=> { $("#demo").scrollIntoView({behavior:"smooth", block:"start"}); setTimeout(verify, 350); });
    els.btnFill.addEventListener("click", loadSample);
    els.btnClear.addEventListener("click", clearAll);
    els.btnJumpDemo.addEventListener("click", ()=> $("#demo").scrollIntoView({behavior:"smooth", block:"start"}));

    [els.toggleNormalize, els.toggleTolerance].forEach(t=>{
      t.addEventListener("click", ()=> toggleToggle(t));
      t.addEventListener("keydown", (e)=>{
        if(e.key === "Enter" || e.key === " "){
          e.preventDefault();
          toggleToggle(t);
        }
      });
    });

    window.addEventListener("keydown", (e)=>{
      const ctrl = e.ctrlKey || e.metaKey;
      if(e.key === "Enter") verify();
      if(ctrl && (e.key.toLowerCase() === "l")){ e.preventDefault(); loadSample(); }
      if(e.key === "Escape") clearAll();
    });

    // XLSX UI events
    els.xlsxFile.addEventListener("change", (e)=> handleXlsxFile(e.target.files?.[0]));
    els.btnAutoMap.addEventListener("click", ()=>{
      if(!xlsxAvailable()){
        showXlsxNeeded();
        return;
      }
      autoDetectAndFill();
    });

    // Initialize toggles
    setToggle(els.toggleNormalize, true);
    setToggle(els.toggleTolerance, true);

    // Scroll reveal
    const io = new IntersectionObserver((entries)=>{
      entries.forEach(en=>{
        if(en.isIntersecting){
          en.target.classList.add("on");
          io.unobserve(en.target);
        }
      });
    }, { threshold: 0.12 });
    document.querySelectorAll(".sr").forEach(el=> io.observe(el));
  </script>

</body>
</html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XLSX Parser - Embedded</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
        }
        input[type="file"] {
            padding: 10px;
            margin: 10px 0;
        }
        button {
            padding: 10px 20px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #218838;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        tr:hover {
            background-color: #f9f9f9;
        }
        #output {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>XLSX File Parser (Embedded)</h1>
        <p>Select an Excel file to parse and display:</p>
        
        <input type="file" id="fileInput" accept=".xlsx, .xls" />
        <button onclick="parseFile()">Parse XLSX</button>
        
        <div id="output"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        function parseFile() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Please select a file');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    let html = '<h2>Parsed Sheets:</h2>';
                    
                    workbook.SheetNames.forEach(sheetName => {
                        const worksheet = workbook.Sheets[sheetName];
                        const jsonData = XLSX.utils.sheet_to_json(worksheet);
                        
                        html += `<h3>Sheet: ${sheetName}</h3>`;
                        
                        if (jsonData.length > 0) {
                            html += '<table><thead><tr>';
                            Object.keys(jsonData[0]).forEach(key => {
                                html += `<th>${key}</th>`;
                            });
                            html += '</tr></thead><tbody>';
                            
                            jsonData.forEach(row => {
                                html += '<tr>';
                                Object.values(row).forEach(val => {
                                    html += `<td>${val}</td>`;
                                });
                                html += '</tr>';
                            });
                            
                            html += '</tbody></table>';
                        } else {
                            html += '<p>Empty sheet</p>';
                        }
                    });
                    
                    document.getElementById('output').innerHTML = html;
                } catch (error) {
                    document.getElementById('output').innerHTML = `<p style="color: red;">Error parsing file: ${error.message}</p>`;
                }
            };
            
            reader.readAsArrayBuffer(file);
        }
    </script>
</body>
</html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XLSX Import Tool</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
        }
        input[type="file"] {
            padding: 10px;
            margin: 10px 0;
        }
        button {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #0056b3;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        tr:hover {
            background-color: #f9f9f9;
        }
        #output {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>XLSX File Parser</h1>
        <p>Select an Excel file to parse and display:</p>
        
        <input type="file" id="fileInput" accept=".xlsx, .xls" />
        <button onclick="parseFile()">Parse XLSX</button>
        
        <div id="output"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        function parseFile() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Please select a file');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    let html = '<h2>Parsed Sheets:</h2>';
                    
                    workbook.SheetNames.forEach(sheetName => {
                        const worksheet = workbook.Sheets[sheetName];
                        const jsonData = XLSX.utils.sheet_to_json(worksheet);
                        
                        html += `<h3>Sheet: ${sheetName}</h3>`;
                        
                        if (jsonData.length > 0) {
                            html += '<table><thead><tr>';
                            Object.keys(jsonData[0]).forEach(key => {
                                html += `<th>${key}</th>`;
                            });
                            html += '</tr></thead><tbody>';
                            
                            jsonData.forEach(row => {
                                html += '<tr>';
                                Object.values(row).forEach(val => {
                                    html += `<td>${val !== null && val !== undefined ? val : '-'}</td>`;
                                });
                                html += '</tr>';
                            });
                            
                            html += '</tbody></table>';
                        } else {
                            html += '<p>Empty sheet</p>';
                        }
                    });
                    
                    document.getElementById('output').innerHTML = html;
                } catch (error) {
                    document.getElementById('output').innerHTML = `<p style="color: red;">Error parsing file: ${error.message}</p>`;
                }
            };
            
            reader.readAsArrayBuffer(file);
        }
    </script>
</body>
</html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XLSX Automated Checking</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #333;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #fafafa;
        }
        input[type="file"] {
            padding: 10px;
            margin: 10px 0;
        }
        button {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px 5px 5px 0;
        }
        button:hover {
            background-color: #0056b3;
        }
        button.success { background-color: #28a745; }
        button.success:hover { background-color: #218838; }
        button.danger { background-color: #dc3545; }
        button.danger:hover { background-color: #c82333; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #007bff;
            color: white;
            font-weight: bold;
        }
        tr:hover {
            background-color: #f9f9f9;
        }
        tr.error {
            background-color: #ffcccc;
        }
        tr.warning {
            background-color: #ffffcc;
        }
        tr.success {
            background-color: #ccffcc;
        }
        #output {
            margin-top: 20px;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 4px;
            border-left: 4px solid #007bff;
        }
        .stat-card h3 {
            margin: 0 0 10px 0;
            color: #666;
        }
        .stat-card .number {
            font-size: 28px;
            font-weight: bold;
            color: #007bff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>📊 XLSX Automated Checking & Analysis Tool</h1>
        
        <div class="section">
            <h2>Upload File</h2>
            <input type="file" id="fileInput" accept=".xlsx, .xls" />
            <button onclick="parseFile()">Parse XLSX</button>
            <button class="danger" onclick="clearAll()">Clear All</button>
        </div>

        <div id="statsContainer"></div>
        
        <div id="output"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        let fileData = null;

        function parseFile() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Please select a file');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    fileData = workbook;
                    
                    displayAnalysis(workbook);
                } catch (error) {
                    document.getElementById('output').innerHTML = `<p style="color: red;">Error parsing file: ${error.message}</p>`;
                }
            };
            
            reader.readAsArrayBuffer(file);
        }

        function displayAnalysis(workbook) {
            let statsHtml = '<div class="stats">';
            statsHtml += `<div class="stat-card">
                <h3>Total Sheets</h3>
                <div class="number">${workbook.SheetNames.length}</div>
            </div>`;
            
            let totalRows = 0;
            workbook.SheetNames.forEach(name => {
                const ws = workbook.Sheets[name];
                const json = XLSX.utils.sheet_to_json(ws);
                totalRows += json.length;
            });
            
            statsHtml += `<div class="stat-card">
                <h3>Total Rows</h3>
                <div class="number">${totalRows}</div>
            </div></div>`;
            
            document.getElementById('statsContainer').innerHTML = statsHtml;
            
            let html = '<h2>Sheet Analysis:</h2>';
            
            workbook.SheetNames.forEach(sheetName => {
                const worksheet = workbook.Sheets[sheetName];
                const jsonData = XLSX.utils.sheet_to_json(worksheet);
                
                html += `<div class="section">
                    <h3>📄 Sheet: ${sheetName}</h3>
                    <p><strong>Rows:</strong> ${jsonData.length}</p>`;
                
                if (jsonData.length > 0) {
                    html += '<table><thead><tr>';
                    Object.keys(jsonData[0]).forEach(key => {
                        html += `<th>${key}</th>`;
                    });
                    html += '</tr></thead><tbody>';
                    
                    jsonData.forEach((row, idx) => {
                        const rowClass = idx % 2 === 0 ? '' : 'style="background-color: #f0f0f0;"';
                        html += `<tr ${rowClass}>`;
                        Object.values(row).forEach(val => {
                            html += `<td>${val !== null && val !== undefined ? val : '-'}</td>`;
                        });
                        html += '</tr>';
                    });
                    
                    html += '</tbody></table>';
                } else {
                    html += '<p>⚠️ Empty sheet</p>';
                }
                
                html += '</div>';
            });
            
            document.getElementById('output').innerHTML = html;
        }

        function clearAll() {
            document.getElementById('fileInput').value = '';
            document.getElementById('output').innerHTML = '';
            document.getElementById('statsContainer').innerHTML = '';
            fileData = null;
        }
    </script>
</body>
</html>
{
  "name": "xlsx-website",
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "xlsx": "^0.18.5"
  },
  "devDependencies": {
    "vite": "^5.0.0"
  }
}

